5.2. 威胁缓解
=================
大范围的威胁可以通过采用数字签名或消息认证码（MAC）保护令牌内容来缓解。另外，不记名令牌可以包含授权信息的引用，而不是直接编码该信息。对于攻击者这些引用不可能被猜测；使用引用可能需要服务器和令牌颁发者之间额外的交互来解析对授权信息的引用。这种交互的机制未由本规范定义。

本文档不指定令牌的编码或内容；因此，关于确保令牌完整性保护的措施的详细推荐在本文档范围之外。令牌完整性保护必须充分防止令牌被修改。

为处理令牌重定向，授权服务器在令牌中包含预期的接收者（听众）——通常是单个资源服务器（或资源服务器列表）——是很重要的。限制令牌在特定范围中使用也是推荐的。

授权服务器必须实施TLS。应当实施哪个（些）版本随着时间变化，且会依赖于实现时的普遍部署和已知的安全弱点。在本规范撰写时，TLS 1.2版[RFC5246][RFC5246]是最新的版本，但它具有非常有限的实际部署并且可能在实现工具箱中还未准备好可用。TLS 1.0版[RFC2246][RFC2246]是部署最广泛的版本并会提供最广泛的互操作性。

为了保护令牌避免泄露，采用具有提供机密性和完整性保护套件的TLS [RFC5246][RFC5246]机密性保护必须被应用。这要求在客户端和授权服务器之间的通信交互，以及运用机密性和完整性保护的客户端和资源服务器之间的交互。由于TLS由本规范强制实施和使用，它是防止在通信信道上令牌泄露的首选方法。对于那些客户端被阻止观察令牌内容的情况，除TLS保护的使用之外令牌加密必须被应用。作为针对令牌泄露的进一步防御，当发起对受保护资源的请求时客户端必须验证TLS证书链，包括检查证书吊销列表（CRL）[RFC5280][RFC5280]。

Cookies通常是明文传输的。因此，任何包含在它们中的信息都有泄露的风险。因此，不记名令牌不能存储在可能以明文传送的cookies中。关于cookies的安全考量参阅“HTTP状态管理机制”[RFC6265][RFC6265]。

在一些部署中，包括那些采用负载均衡部署，到资源服务器的TLS连接在提供资源的实际服务器前终止。这可能导致令牌在TLS连接终止处的前端服务器和提供资源的后端服务器之间未受保护。在这种部署中，足够的措施必须被使用以确保在前端和后端服务器之间的令牌机密性；令牌加密是一种这样的可能手段。

为处理令牌捕获和重放，做出了如下推荐：首先，令牌的生命周期必须被限制；一种达到这一目标的方法是通过放置有效时间字段在令牌的受保护的部分内。请注意，采用短暂（一小时或更少）的令牌减少它们被泄露之后的影响。其次，客户端和授权服务器之间以及客户端和资源服务器之间的交互的机密性保护必须被应用。作为结果，沿着通信路径没有窃听者能够观察到令牌交换。因此，这样的路径上对手无法重放令牌。此外，当提交令牌给资源服务器时，客户端必须按照“TLS上的HTTP”[\[RFC2818\]][RFC2818]3.1节验证资源服务器的身份。注意当发起对受保护资源的这些请求时客户端必须验证TLS证书链。提交令牌给未经过身份验证或未授权的资源服务器或者验证证书链失败会允许对手窃取令牌并获得对受保护资源的未授权的访问权限。

[RFC5246]: http://tools.ietf.org/html/rfc5246 "The Transport Layer Security (TLS) Protocol Version 1.2"
[RFC2246]: http://tools.ietf.org/html/rfc2246 "The TLS Protocol Version 1.0"
[RFC5280]: http://tools.ietf.org/html/rfc5280 "Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"
[RFC6265]: http://tools.ietf.org/html/rfc6265 "HTTP State Management Mechanism"
[RFC2818]: http://tools.ietf.org/html/rfc2818 "HTTP Over TLS"